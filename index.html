<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Просмотр фото</title>
    <style type="text/css">
        body {
            margin: 0px;
            font-family: 'Tahoma';
        }

        a {
            color: darkgray;
        }

        p {
            text-align: center;
        }

        p.content {
            display: inline-block;
            padding: 10px;
            border: 1px solid lightgray;
        }

        .container {
            width: 800px;
            margin: auto;
            text-align: center;
        }

        span.title {
            font-size: 14pt;
            text-align: center;
        }

        span.nophoto {
            color: red;
            display: inline-block;
            margin-top: 200px;
        }

        a:has(span.title) {
            text-decoration: none;
            color: black;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <p>
            <a href="/" title="Latest">
                <span class="title">Фото с камеры</span>
            </a>
        </p>

        <p class="content">
            %if show:
                <img src="/photo/{{idx}}" alt="photo" />
            %else:
                <span class="nophoto">Нет загруженных фотографий</span>
            %end
        </p>

        <p class="links">
            %if has_prev:
                <a href="/{{str(idx - 1) + ('?static=1' if static else '')}}">&lt;&lt;</a>
            %else:
                <span>&lt;&lt;</span>
            %end

            &nbsp;
            {{idx + 1}} / {{total}}
            &nbsp;

            %if has_next:
                <a href="/{{str(idx + 1) + ('?static=1' if static else '')}}">&gt;&gt;</a>
            %else:
                <span> &gt;&gt;</span>
            %end
        </p>

        %if not static:
            <p class="buttons">
                <button type="button">Воспроизведение / Пауза</button>
            </p>
        %end
    </div>

    <script type="text/javascript">
        window.addEventListener('load', () => {
            const AUTO_PLAY = true;
            const FRAME_INTERVAL = 500;

            const LATEST_FRAME_URL = '/photo/latest';

            let isPlaying = AUTO_PLAY;
            let playIntervalId = null;

            const imageElem = document.querySelector('p.content img');
            const playButton = document.querySelector('p.buttons button');

            function togglePlayState(play) {
                if (play) {
                    togglePlayUi(play);
                    playIntervalId = setInterval(() => {
                        imageElem.src = LATEST_FRAME_URL + '?r=' + Math.random();
                    }, FRAME_INTERVAL)
                } else {
                    clearInterval(playIntervalId);
                    togglePlayUi(false);
                }
            }

            function togglePlayUi(isPlaying) {
                const linksBlock = document.querySelector('p.links');

                if (isPlaying) {
                    linksBlock.classList.add('hidden');
                } else {
                    linksBlock.classList.remove('hidden');
                }
            }

            if (playButton != null) {
                playButton.onclick = () => {
                    isPlaying = !isPlaying;
                    togglePlayState(isPlaying);
                };

                togglePlayState(isPlaying);
            }
        });
    </script>
</body>
</html>